# AGENTS.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

ShoeboxSim is a Unity 6 (6000.0.62f1) creature simulation game where small creatures called "Grems" live inside a shoebox diorama. Players observe, feed, and interact with Grems by dragging them and dropping food. The project uses the Universal Render Pipeline (URP) and Unity's new Input System.

## Build & Run

This is a Unity project — it must be opened and built through the Unity Editor. There is no CLI build pipeline configured.

- **Unity version**: 6000.0.62f1
- **Solution files**: `ShoeboxSim.sln` / `Shoebox.sln` (auto-generated by Unity)
- **Render pipeline**: URP (com.unity.render-pipelines.universal 17.0.4)
- **Input**: New Input System (`com.unity.inputsystem` 1.14.2) — all input uses `Mouse.current`, `Keyboard.current` from `UnityEngine.InputSystem`

There are no custom test suites, lint scripts, or CI pipelines. The test framework package is included but unused.

## Architecture

### AI Systems

- **Preferred System**: The Behaviour Tree System (`Assets/Scripts/BTs WIP/`) is the designated AI approach for Grem behavior. All new AI development and modifications should focus on this system.
    - **`TaskCheckDragging`**: This node now handles the complete Grem dragging functionality, including input detection, Grem movement with the mouse, and applying a visual "struggle" effect.

- **Deprecated System**: The Behaviour-Component System (`Assets/Scripts/GremData/`) is considered deprecated and will no longer be actively used or developed.

### Food System (`Assets/Scripts/GremData/Food/`)

- **`FoodData`** (ScriptableObject) — Defines food properties (name, hunger restore, special effect, effect duration). Created via `GremSystem/GremData` asset menu. Uses `FoodEffect` enum (`None`, `SpeedBoost`).
- **`FoodItem`** — MonoBehaviour attached to food GameObjects; holds a `FoodData` reference. Food objects must be tagged `"Food"`.

### Game Economy

- **`CurrencyManager` (Singleton MonoBehaviour)**: Manages the game's currency, allowing other systems to add or spend currency.
- **`GremCurrencyProducer` (MonoBehaviour)**: Attached to Grem GameObjects, this script handles currency production outside the Behavior Tree. It uses `GremData` for production values, reduces production rate if the Grem is hungry or sleepy, and stops production when the Grem is sleeping.

### Player Interaction (`Assets/Scripts/PlayerActions/`)

- **`Feed`** — Spawns `marshmallowPrefab` at mouse click position on the floor. Raycasts against `floorLayer` and `gremLayer` — clicking a Grem does not spawn food.
- **`InputManager` (Static Class)**: Manages global input states, such as `IsFeedingEnabled`. Toggled by 'F' key. Designed for easy future integration with UI elements.
- **`InputManagerHook` (MonoBehaviour)**: A simple MonoBehaviour to call `InputManager.HandleGlobalInput()` in `Update()`, allowing the static `InputManager` to process input. Should be attached to an active GameObject in the scene.
- **`FurniturePlacementManager`**: Handles the selection, placement, and manipulation of furniture items within the scene. Activated by the 'B' key, allowing users to pick a furniture prefab, move it with the mouse, rotate it with 'R', and place it with left-click (or cancel with right-click).
- **Grem Dragging**: The dragging of Grems is now handled by the `TaskCheckDragging` Behavior Tree node using physics. When dragging, the Grem's `Rigidbody` is controlled to pull it towards the mouse position, allowing it to collide and be stopped by physical barriers like walls.

### Camera (`Assets/Scripts/CameraControl/`)

Uses a pivot-based camera rig (parent pivot + child Camera).

- **`PanCamera`** — Full-featured: orbit (right-click), pitch (vertical right-click), pan (middle-click or shift+right-click), scroll zoom. Clamps within `boxLimits`.
- **`PlayerCamera`** — Simpler: horizontal orbit + zoom only.
- **`WallFader`** / **`WallTransparency`** — Raycasts from camera to pivot; walls in the way get dissolved via a `_Dissolve` shader property on `DitherShader.shadergraph`.

### Other

- **`Assets/IA/`**: This folder and its contents should be ignored by the AI agent for modifications, but NOT from version control (`.gitignore`). It contains unused or deprecated steering AI concepts.
- **`Assets/Shaders/DitherShader.shadergraph`** — URP Shader Graph with a `_Dissolve` float property on the wall transparency system.
- **`Assets/TO DO/`**: This folder is used to store text files (e.g., `ZZZ_implement.txt`, `FurniturePlacement_implement.txt`) that provide manual setup instructions for functionalities requiring Unity Editor or prefab modifications that cannot be automated via code.

## Key Conventions

- All scripts are in the global namespace (no C# namespaces) except `SteeringOutput` (`IA26.Movement`).
- `ScriptableObject`s are used for data configuration, created from the `GremSystem/` asset menu.
    - **`GremData`**: Now includes `currencyProductionValue` and `currencyProductionRate` fields to define how much and how often a Grem produces currency. Also includes `squashAmount` and `squashSpeed` for visual squish and squash effects during movement, and `dragPullForce` to control the strength of physics-based dragging.
- **`GremBT`**:
        - Now tracks `previousPosition` to calculate movement direction.
        - Includes `ApplySquashAndSquishEffect(float progress, float amount, float speed)` for generalized visual scaling.
        - Includes `ResetSpriteScale()` to restore original scale.
        - Includes `FlipSpriteToDirection(Vector3 direction)` to orient the Grem's sprite based on its horizontal movement.
        - **Physics-Based Dragging**: Now requires a `Rigidbody` component and manages physics-driven movement when `isBeingDraggedPhysics` is true, moving towards `dragTargetPosition` in `FixedUpdate()`.
- Input is always read via Unity's new Input System static accessors (`Mouse.current`, `Keyboard.current`), never the legacy `Input` class.
- Sprites are billboarded to face the camera in `LateUpdate` using `Camera.main`.
    - **`GremBT`**: Now includes `ApplySquashAndSquishEffect` and `ResetSpriteScale` methods to visually modify the Grem's sprite based on movement.
    - **`TaskWander`**: Now calls `GremBT.ApplySquashAndSquishEffect` during movement to animate the Grem.
    - **`TaskMoveToFood`**: Also calls `GremBT.ApplySquashAndSquishEffect` during movement to animate the Grem.
    - **`TaskSleep`**: Now calls `GremBT.ApplySquashAndSquishEffect` with sleep-specific parameters to create a breathing effect.
- Food GameObjects must have the `"Food"` tag to be discoverable by Grem AI.
- Grem movement is bounded by `minBounds`/`maxBounds` defined in `GremData`.

## Commenting Conventions

- All comments have been removed from C# scripts. Do not add any new comments.

## External Dependencies & Manual Setup

- If a requested functionality requires manual work in the Unity Editor (e.g., changing Inspector properties, creating new assets/prefabs, or any step that cannot be automated via code changes), a unique text file detailing the necessary steps will be created in the `Assets/TO DO/` folder. This file will serve as a guide for the user to complete the implementation.